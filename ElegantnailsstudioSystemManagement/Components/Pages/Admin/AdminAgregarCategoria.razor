@page "/admin/categorias/agregar"
@using ElegantnailsstudioSystemManagement.Models
@inject ICategoriaService CategoriaService

<PageTitle>Crear Categoría</PageTitle>

<div style="padding: 20px;">
    <h1 style="color: darkblue;">CREAR NUEVA CATEGORÍA</h1>

    <EditForm Model="nuevaCategoria" OnValidSubmit="Guardar">
        <div style="margin: 20px 0;">
            <label style="font-weight: bold; display: block; margin-bottom: 5px;">Nombre:</label>
            <InputText @bind-Value="nuevaCategoria.Nombre"
                       style="width: 300px; padding: 8px; font-size: 16px;" />
        </div>

        <button type="submit" style="background: green; color: white; padding: 10px 20px; font-size: 16px; border: none; cursor: pointer;">
            Guardar Categoría
        </button>
    </EditForm>

    @if (!string.IsNullOrEmpty(mensaje))
    {
        <div style="margin: 20px; padding: 10px; background: @(error ? "#ffe6e6" : "#e6ffe6");">
            @mensaje
        </div>
    }
    <div class="mt-3">
        <a href="/admin/categorias" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>Atrás
        </a>
    </div>
</div>

<div style="margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px;">
    <h3>Categorías existentes:</h3>
    <ul>
        @foreach (var cat in categorias)
        {
            <li>@cat.Id - @cat.Nombre</li>
        }
    </ul>
</div>

@code {
    // 🔹 Acá va el objeto que representa la nueva categoría
    private Categoria nuevaCategoria = new Categoria();

    private string mensaje = "";
    private bool error = false;
    private List<Categoria> categorias = new();

    // 🔹 Cargar categorías al iniciar
    protected override async Task OnInitializedAsync()
    {
        await CargarCategorias();
    }

    private async Task CargarCategorias()
    {
        categorias = await CategoriaService.GetCategoriasAsync();
    }

    // 🔹 Método que se ejecuta al enviar el formulario
    private async Task Guardar()
    {
        try
        {
            if (string.IsNullOrWhiteSpace(nuevaCategoria.Nombre))
            {
                mensaje = "Por favor, ingresa un nombre";
                error = true;
                return;
            }

            var guardado = await CategoriaService.CreateCategoriaAsync(nuevaCategoria);

            if (guardado)
            {
                mensaje = "¡Categoría guardada correctamente!";
                error = false;

                // Reiniciar formulario
                nuevaCategoria = new Categoria();
                await CargarCategorias();
            }
            else
            {
                mensaje = "La categoría ya existe o no se pudo guardar.";
                error = true;
            }
        }
        catch (Exception ex)
        {
            mensaje = "Error: " + ex.Message;
            error = true;
        }
    }
}






