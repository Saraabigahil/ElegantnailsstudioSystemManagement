@page "/admin/categorias/modificar/{id:int}"
@using ElegantnailsstudioSystemManagement.Models
@using ElegantnailsstudioSystemManagement.Services
@inject ICategoriaService CategoriaService
@inject NavigationManager Navigation

<PageTitle>Elegant Nails - Modificar Categoría</PageTitle>

<div class="formulario-modificar-categoria">
    <div class="contenedor-principal">
        <div class="encabezado">
            <div class="d-flex justify-content-between align-items-center">
                <div class="titulo-contenedor">
                    <h1 class="titulo-principal">
                        <i class="bi bi-pencil-square"></i>
                        Modificar Categoría
                    </h1>
                    <p class="subtitulo">Actualiza los detalles de la categoría existente</p>
                </div>
                <a href="/admin/categorias" class="btn-volver">
                    <i class="bi bi-arrow-left"></i>
                    Volver a Categorías
                </a>
            </div>
        </div>

        <div class="contenido-pantalla-completa">
            @if (categoria == null)
            {
                <div class="estado-carga">
                    <div class="spinner-grande">
                        <div class="spinner"></div>
                        <p class="texto-carga">Cargando categoría...</p>
                    </div>
                </div>
            }
            else
            {
                <div class="formulario-grande">
                    <EditForm Model="categoria" OnValidSubmit="ActualizarCategoria" FormName="categoriaForm">
                        <DataAnnotationsValidator />

                        <div class="tarjeta-formulario">
                           
                            <div class="encabezado-formulario">
                                <div class="icono-grande">
                                    <i class="bi bi-tag"></i>
                                </div>
                                <h2>Información de la Categoría</h2>
                                <p class="descripcion">Modifica el nombre de la categoría según sea necesario</p>
                            </div>

                            <div class="cuerpo-formulario">
                                <div class="grupo-formulario">
                                    <label class="etiqueta-formulario">
                                        <i class="bi bi-fonts"></i>
                                        Nombre de la Categoría
                                    </label>
                                    <div class="input-contenedor">
                                        <InputText @bind-Value="categoria.Nombre"
                                                   class="input-grande"
                                                   placeholder="Ejemplo: Manicura, Pedicura, Uñas Esculpidas..." />
                                        <div class="icono-input">
                                            <i class="bi bi-pencil"></i>
                                        </div>
                                    </div>
                                    <ValidationMessage For="@(() => categoria.Nombre)" />
                                    <div class="ayuda-texto">
                                        <i class="bi bi-info-circle"></i>
                                        Ingresa un nombre descriptivo para la categoría
                                    </div>
                                </div>

                                <div class="contenedor-botones-grandes">
                                    <button type="submit" class="btn-guardar-grande">
                                        <i class="bi bi-check-circle-fill"></i>
                                        <span class="texto-boton">GUARDAR CAMBIOS</span>
                                    </button>

                                    <button type="button" onclick="window.location.href='/admin/categorias'"
                                            class="btn-cancelar-grande">
                                        <i class="bi bi-x-circle"></i>
                                        <span class="texto-boton">CANCELAR</span>
                                    </button>
                                </div>

                                @if (!string.IsNullOrEmpty(mensajeError))
                                {
                                    <div class="mensaje-error">
                                        <i class="bi bi-exclamation-triangle"></i>
                                        <span>@mensajeError</span>
                                    </div>
                                }
                            </div>
                        </div>
                    </EditForm>
                </div>
            }

           
        </div>

        <!-- Pie de página -->
        <div class="pie-pagina">
            <div class="d-flex justify-content-between align-items-center">
                <div class="info-pie">
                    <i class="bi bi-calendar-check"></i>
                    Elegant Nails Studio • Sistema de Gestión
                </div>
                <div class="acciones-pie">
                    <button class="btn-ayuda">
                        <i class="bi bi-question-circle"></i>
                        Ayuda
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter] public int Id { get; set; }
    private Categoria? categoria;
    private string mensajeError = "";

    protected override async Task OnInitializedAsync()
    {
        await CargarCategoria();
    }

    private async Task CargarCategoria()
    {
        categoria = await CategoriaService.GetCategoriaByIdAsync(Id);
    }

    private async Task ActualizarCategoria()
    {
        try
        {
            if (categoria == null || string.IsNullOrWhiteSpace(categoria.Nombre))
            {
                mensajeError = "El nombre de la categoría es requerido";
                return;
            }

            var exito = await CategoriaService.UpdateCategoriaAsync(categoria);

            if (exito)
            {
                Navigation.NavigateTo("/admin/categorias");
            }
            else
            {
                mensajeError = "Error al actualizar la categoría. Puede que ya exista una con ese nombre.";
            }
        }
        catch (Exception ex)
        {
            mensajeError = $"Error al actualizar: {ex.Message}";
        }
    }
}